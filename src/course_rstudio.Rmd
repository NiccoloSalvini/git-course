---
title: "Git attraverso RStudio"
author:
- Niccol√≤ Salvini
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    fig_caption: false
---


```{r setup, include=F}

library(rvest, quietly = T, warn.conflicts = F)
library(magrittr, quietly = T, warn.conflicts = F)

```

# Setup

Prima di cominciare questo tutorial assumo che:

* tu abbia [R](https://lib.ugent.be/CRAN/) e [Rstudio](https://www.rstudio.com/products/rstudio/download/) installati e funzionanti sul computer (~ 5 min).
* tu abbia [git](https://git-scm.com/) installato sul computer e puntanto sul file `git.exe`. (~ 3 min.)

Per verificare la corretta installazione di Git entra su RStudio, poi apri il terminale i.e. "Terminal", Si trova accanto alla "Console" da dove esegui di solito i comandi in R. Nel caso tu avessi difficolt√† a trovarlo su Windows premi contemporamente Alt+Shift+M, su Mac Cmd+Shift+M (da verificare). Se ancora non vedi il terminale Shift+Alt+T (Tools->Terminal->Move Focus to Terminal). 
Una volt sul terminale esequi i seguenti comandi:

```
which git
```

Dovesti vedere come risposta del terminale qualcosa come:  **/usr/local/bin/git**.
Successivamente esegui:

```
git --version
```

L'ultima versione di `git` disponibile √® la `r read_html("https://git-scm.com/") %>%  html_nodes(css = ".version") %>%  html_text(trim = T)`. Corrisponde a quella installata? Se s√¨ procedi avanti. Se non corrisponde o compare qualche altro errore sentiti libero di mandarmi una mail [me medesimo](mailto:niccolo.salvini27@gmail.com). Se hai installata una versione precedente di `git` non occorre aggiornare per questo tutorial, anche se puoi considerare l'idea di farlo in prossimo futuro.

* tu abbia un [account GitHub](https://github.com/join), pensa due secondi in pi√π al tuo nome utente, sei sempre a tempo a cambiarlo, ma potresti incorrere nei [seguenti problemi](https://docs.github.com/en/github/setting-up-and-managing-your-github-user-account/changing-your-github-username) (~ 1 min.).

---

# Lavora da solo {data-background=##75aada}

Di solito si comincia inizializzando una repository su GitHub, nel gergo tecnico  _init_. Per questo step non hai assolutamente bisogno di un collaboratore/collega.

---

## Crea una repo (che sta per _repo_ sitory)

Abituati a pensarla sempre in questi termini: 

> Un nuovo progetto comincia sempre con una nuova repo.
>
> `r tufte::quote_footer('--- Git Samurai')`


Cominciare una nuova repo direttamente da [GitHub.com](https://github.com) √® estremamente semplice:

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. vai su [GitHub](https://github.com) ed esegui il login
2. segui [questo tutorial](https://help.github.com/articles/create-a-repo/) dalla documentazione originale per creare una repo [crea il tuo primo commit](https://help.github.com/articles/create-a-repo/#commit-your-first-change) alla tua repository
</div>

---

Per questo esercizio abbiamo deciso di creare una _dummy repo_.

![crea una repo](./static/images/create-a-repo.png)
(*scegli il nome che vuoi, non sia mai che ti suggerisca cosa fare!*)

---

Gi√† fatto `r emo::ji("smile")`. Il risultato finale √® il seguente:


![il risulato della creazione di una repo](./static/images/create-repo-result.png)


:::bulb
**Ricordati il tasto verde code, ci sar√† molto utile pi√π tardi!**
:::

---

## La configurazione di Git per RStudio

Dato il fatto che useremo Git(Hub) per amministrare esclusivamente scripts R/Rmarkdown, l'integrazione di RStudio con Git fa al caso nostro fornendo un'interfaccia facile e intuitiva come VCS (**V**ersion **C**ontrol **S**ystem).
Ci sono altri git clients, detti **SCM**, di versioning, alcuni totalmente a pagamento, alcuni _freemium_ con limitazioni e altri open source, [qui una lista completa](https://git-scm.com/downloads/guis):
Alcuni sperimentati:

* [gitKraken](https://www.gitkraken.com/) client notevole e veloce (lo utilizza chi scrive). Molti addons come Trello o Jira (supporta Bitbucket e Gitlab, omologhi di GitHub). Permette di costruire linee del tempo per tenere traccia di traguardi nello sviluppo. Permette di avere una lavagna di Kaban per assegnare (nello stile di Trello) obiettivi ai collaboratori. sviluppo su repo private non concesso. Possibilit√† di collaborazione direttamente su Kraken. Interoperabile, va bene per Windowws, Linux e MacOS.
* [fork](https://git-fork.com/) Vincenzo pu√≤ aiutarmi @vicnardelli
* [GitHub Desktop](https://desktop.github.com/)
* [Sourcetree](https://www.sourcetreeapp.com/) gratis, perfetto per Windows, non per il resto dei sistemi operativi su cui fa fatica e commette errori che non vengomo risolti dai mantenitori del client.


### Installazione

:::warn
**Sii assolutamente sicuro che tu abbia installato i requisiti:**
:::


<!-- <div class="bs-callout bs-callout-exercise"> -->
<!-- <h4>Esercizio:</h4> -->
<!-- 1. [Download](https://git-scm.com/downloads) Git -->
<!-- 1. Installa [RStudio](https://inbo.github.io/tutorials/installation-RStudio-admin.html) -->
<!-- </div> -->

Quando sono installate correttamente allora:

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Apri [RStudio](https://inbo.github.io/tutorials/installation-RStudio-user.html)
</div>

---

### Configurazione (potrebbe essere diversa)

Per cominciare ad utilizzare lo strumento di versioning dobbiamo impostare una configurazione, fortunatamente lo facciamo _una tantum_.

Per prima cosa √® necessario indicare ad RStudio dove si trova l'executable di Git (il file tramite cui Git esegue i comandi).

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Vai su`Tools > Global Options`
1. Clicca su `Git/SVN`.
1. Assicurati che: *Enable version control interface for RStudio projects*
1. Imposta il path che punta diretto all'executable di git (dove c'√® l'installazione)
1. Assicurati che *use Git bash as shell for Git projects*
</div>

---

Se non ti ricordi o non sai dove hai installato git e l'eseguibile di git (il **punto 4** dei passaggi precedenti) allora apri il terminale da windows con WIN+R e scrivi `cmd`, premi enter (su Mac apri Bash). Aperto il terminale scrivi `where git`, la rispota ti dir√† dove si trova il file. confronta la tua risposta con la mia: `C:/Program Files (x86)/Git/bin/git.exe`, √® simile? Se s√¨ procedi. Se invece riscontri ancora problemi con la ricerca dai un'occhiata [a questo](http://happygitwithr.com/rstudio-see-git.html#tell-rstudio-where-to-find-git).

![RStudio setup for git](./static/images/RStudio-setup-git.png){width=50%}

---
Adesso dobbiamo dire a GitHub chi siamo, con l'obiettivo di stabilire una connessione all'account online. Per farlo git ha bisogno delle credenziali di GitHub, i.e. username e GitHub email:

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. vai su `Tools > Shell` e apri shell
1. nella shell, scrivi i seguenti comandi e premi invio.
```
git config --global user.name "mygithubusername"
```
1. Sempre nella shell scrivi il seguente comando completando con la mail di registrazione e premi invio:
```
git config --global user.email "my.name@gmail.com"
```
</div>

---

![RStudio setup git shell](./static/images/Rstudio-GitShell.png){width=75%}


Mi raccomando usa il tuo **username GitHub**! Per verificare che tutta la configurazione sia andata a buon fine esegui questo comando: `git config --global --list`

Se la configirazione ha avuto esito positivo allora congratulazioni, il tuo setup √® finito! üëç

---


Se ti trovi male con la configurazione da terminale recentemente il pacchetto `usethis` ha introdotto una serie di funzioni per interagire con Git e GitHub. Qui copriamo solo lo "handshake" tra Git e RStudio, ma molto copre molte alte operazioni di verisoning come la **P**ull **R**equest etc. una sezione sar√† interamente dedicata al set up completo tramite `usethis`:


```{r usethis, eval=F}

## Installa il pacchetto se necessario (solo una volta)
## install.packages("usethis")

library(usethis)
use_git_config(user.name = "Jane Doe", user.email = "jane@example.org")

```

Per verificare la corretta configurazione esegui lo stesso comando da terminale:

```
git config --global --list
```



## Clona una repo per lavorarci in locale

Prima abbiamo inizializzato una repo online e abbiamo configurato git per cooperare con RStudio. Adesso possiamo cominciare a lavorare sul codice localmente scaricando la repo sul laptop. RStudio provvede ad occuparsi di tutto questo in una maniera molto conveniente e facile. 

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. vai sulla pagina GitHub della tua nuova repo copiando l'url **HTTPS** (*ricordi il bottone di prima?*)
1. in Rstudio prosegui per `File > New Project...`, seleziona `Version Control` e scegli `Git`
1. nella prima casella in alto, copia e incolla l'url **HTTPS** (in automatico il nome della cartella che contiene il progetto viene completata)
1. naviga fino alla cartella copiata dove desideri mettere tutti i tuoi progetti/codici R.
</div>

--- 

Per avere l'indirizzo **HTTPS** di clone della repo √© sufficiente cliccare sopra <span style="color: green;">code</span> e premere sul piccolo bottone accanto all'indirizzo per copiare direttamente su clipboard (in alternativa seleziona e copia tutto l'url).

![Copy the https link of a repo](./static/images/copy-repo-link.png){width=75%}

---
Un esempio di setup del progetto utilizzando una repo Git pu√≤ essere questo:

![Clone a repo in RStudio](./static/images/create-project-rstudio.png){width=75%}

---

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
Cerca la cartella che corrisponde alla git repo nella destinazione al punto 4 dell'esercizio. Il contenuto della cartella corrisponde a quello che c'√® nella repo online?
</div>

---

## `.gitignore`

Quando si inizia un nuovo progetto in RStudio, ma anche in Python e tanti altri linguaggi √® utile (anche se non propio indispensabile) aggiungere il file `.gitignore` se non esiste gi√†. E' infatti possibile in fase di inizializzazione della repo online, direttamente da GitHub, creare il `.gitignore` default o custom (se hai difficolt√† a comporre il file `.gitignore` assicurati di trovare un progetto simile al tu su GitHub e copia il contenuto, in alternativa naviga in [questo strumento online gratuito](https://www.toptal.com/developers/gitignore) speficificando i software che utilizzi e in automatico questo comporr√† il perfetto `.gitignore`).
Il file `.gitignore` definisce tutti quei files che **non** devono finire nella repo online per diversi motivi, eccone alcuni:

- ci sono delle credenziali segrete `.Renviron` o`.Rprofile`  ( TODO: link a come storare credenziali segrete in R)
- files di sessione `.RData`
- files di logs e history `.Rhistory` e `.Rapp.history`
- file di sistema prodotti da RStudio, come`myprojectname.Rproj` 
- file specifici dell'utente `.Ruserdata`
- files temporanei creati da R Markdown, esempio: `*.utf8.md` e `*.knit.md`.
- files/ cartelle di cache come  `*_cache/` o `/cache/`
- tokens per [OAuth2 authorization](https://github.com/r-lib/httr/releases/tag/v0.3), come `.httr-oauth`
- Se stai scivendo un pacchetto: files di risposta in seguito ad un **R CMD build**, come `/*.tar.gz`; files di risposta in seguito ad un **R CMD check** come `/*.Rcheck/`
- altri che dipendono dalle esigenze specifiche del progetto espressi con una sintassi particolar, come tutti i files preceduti da "_" nel build con `bookdown`

Quindi rimandendo sullo stretto necessario se non c'√® gi√† possiamo aggiungere un file di testo (`File > New File > Text File`) rinominandolo `.gitignore` e aggiungere nel file il seguente testo `myprojectname.Rproj`, in alternativa come nell'esercizio:

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. vai sul `git` pane (la tab dove c'√® scritto Git), 
1. tasto destro sopra il file `....Proj` e seleziona nel men+ a tendina `Ignore...`
1. controlla se iul contenuto del `.gitignore` √® correttamente aggiornato, poi clicca `Save`.
</div>

---

Visto che il nostro porgetto dummy √®p rinominato `favourite-fruit-color`, il corrispondente `.Rproj` file √® `favourite-fruit-color.Rproj`. Cliccando il tasto destro del muose sul file √® possibile selezionare ignora:

![Ignore a file](./static/images/gitignore-rstudio1.png){width=75%}

---

Linee guida su quando √® necessario usare il file `.gitignore`:

* in ogni linguaggiuo di progrannazione dove alcuni files dono *derivati* di altri
* quando ci sono informazioni sensibili che non devono assolutamente essere condivise e non possono essere immagazzinate negli scripts (passwords di Accounts, di database, tokens di Dropbox, etc...)
* quando c'√® una cartella con files di grandi dimensioni che non deve finire nella history (bens√¨ backed up da qualche altra parte)
* una cartella con files temporanei o con esempi come _temp/_ o _*-Ex.R_

---

Nota che la sintassi del `.gitignore` √® molto intuitiva e permette tramite wildcards di estendere l'ingnore a tutti i files con la medesima estensione ( per esempio `*.Rproj`) o con il medesimo prefisso o suffisso.

![Update .gitignore](./static/images/gitignore-rstudio2.png){width=75%}

---

Controllla il contenuto del `.gitignore`, se sei soddisfatto premi `Save`:

![Update .gitignore](./static/images/gitignore-rstudio2.png){width=75%}

---

## Fa il **commit**

Visto che il `.gitignore` √® stato modificato git ha registrato un cambiamento nella <span style="color: green;">repo locale</span> che non √® nella <span style="color: red;">repo online</span> di GitHub.
Allora data la nuova aaggiunta/modifica del presistente `.gitignore` possiamo fare il `commit` di questo cambiamento e fornire un messagio ce spieghi il cambiamento fatto.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Vai sul `git` pane
1. Spunta la casella accanto a `.gitignore`
1. Clicca `Commit`
1. Aggiungi un messaggio premendo su `commit message` e clicca commit
1. Clicca `Close` per rimuovere il summary del commit
</div>

---

Adesso lo stato del `.gitignore` prima che il file venga committato √® giallo con un punto interrogativo accanto. Questo significa che Git ha notato un cambiamento/aggiunta di quel file.

![Local commit](./static/images/commit-rstudio1.png){width=75%}

---

Spuntando la casella accanto al `.gitignore` (oppure selezionandolo e premendo invio) e cliccando su commit si apre una finestra di dialogo dove viene chiesto a destra di inserire un messaggio di commit. 
(rivdere) 
Ogni messaggio di commit ha un header, cio√® un titolo dove viene spesso riassunto il cuore di quello che √® stato fatto per poi lasciare uno spazio bianco sotto l'headere ed elencare con un elenco puntato e numerato quali sono materialemente le operazioni fatte o il motivo. Il messaggio di commit √® una vera e propria **arte** deve essere _semplice_, _chiaro_ e sempre nell'ottica di far capire ad un terzo, molto probabilmente te nel futuro cosa tu abbia fatto e perch√® lo hai fatto. [Questo post](https://chris.beams.io/posts/git-commit/) pu√≤ aiutarti a scrivere in maniera pi√π efficace un commit seguendo alcune linee guida.
Alcuni SCM (non quello intgrato nella IDE di RStudio) prevedono la possibilit√† di creare un template per il commit, cosicch√® ogni volta che un file o un gruppo di files viene committato un template di commit viene generato e il processo di revisione del codice √® meglio struttuato e pi√π riproducibile. 
Dietro questa semplice operazione ci sono 


![Local commit](./static/images/commit-rstudio2.png){width=75%}

---

Dopo questo abbiamo una piccola panoramica tecnica di quello che sta succedendo (quello che √® stato aggiunto, quello che √® stato tolto, quello che √® stato modificato)

![Local commit](./static/images/commit-rstudio3.png){width=75%}

---
E buona pratica **committare spesso**. Questo permette di spezzettare la logica dello sviluppo del software in tante e piccole singole operazioni su cui si pu√≤ intervenire in maniera stagna. L'uso frequente di commits permette anche di evitare alcuni probelmi comuni sia di GitHub che di RStudio. Un problema √® il tempo di attesa del commit, infatti il git pane di RStudio √® molto pratico ma non √® ottimizzato. Fare un commit molto grosso con tanti files potrebbe richiedere molto tempo e in alcuni casi git potrebbe sputare un errore. (related issue)

La documentazione √® un aspetto cruciale dello sviluppo di ogni software, prima ancora che per gli altri **per te stesso**. Il file `README.md`  ti aiuta a capire lo scopo del progetto. Adesso possiamo provare a modificare il file `README.md` localmente e procedere alla stessa maniera.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Aggiorna il file `README.md` direttamente da dentro RStudio
1. Commit i cambiamenti
</div>

---


Ricorda che il report dei cambiamenti nel panel in basso barra in rosso le linee di codice che sono sparite dal file e in verde quelle aggiunte o modificate:

![Local commit](./static/images/commit-rstudio4.png){width=75%}

---

## Push dei cambiamenti su GitHub

Nota che `git` ti avverte che *your branch is ahead of 'origin/master' by 2 commits*, questo significa che ancora i tuoi cambiamenti sono in fase di stage, devono ancora essere trasmessi alla repo di GitHub online. Per trasmettere i cambiamenti a GitHub premi `push`.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Clicca `push` nel `git` pane
1. Vai su GitHub all'indirizzo della tua repository e verifica il commit, il messaggio e i cambiamenti
</div>

---

RStudio successivamente ti avverte sullo stato dei tuoi commits locali rispetto a quelli mandati `push`ed a GitHub:

![Push](./static/images/push-rstudio1.png){width=75%}

---

Adesso su GitHub il `README.md` √® aggiornato? Dove si trova la panoramica dei commits sulla repo online?

![Verify your commits on GitHub](./static/images/local-commit-on-github.png){width=75%}

---

## Configurazioni Addizionali - metti da parte la password üîë

Non √® per caso noioso tutte le volte rimettere la propria password ogni volta che viene `push`ato qualcosa alla repo?  
Fortunatamente cos√¨ come per _Username_ e _mail_, anche con la password √® possibile fare la stessa cosa usando il protocollo sicuro **HTTPS**.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Clicca su `More` nel `git` pane e seleziona `Shell`
1. Scrivi `git config --global credential.helper store` e premi invio
1. Scrivi `exit` e premi invio per uscire dalla shell
</div>

La prossima volta che `git` avr√† bisogno delle tue credenziali **te le chieder√† solo una volta** e le manterr√† per tutte le operazioni successive.

---

Il bottone "More" ha il simbolo di un **ingranaggio** ‚öôÔ∏è: 

![Store credentials](./static/images/https-credentials-rstudio1.png){width=75%}


---

## Crea un commit logico

Come anticipato prima, la buona pratica di sviluppo di software prevede di committare spesso e mappare in modo chiaro e sintetico la relazione tra problema da risolto e codice cambiato/aggiunto. Tuttavia alcune volte questo prevede che l'aggiunta di cambiamenti alla codebase avvenga in due diversi commits. L'interfaccia di RStudio include anche la possibilit√† di specificare qualche linea di codice nel messagio del commit:

![Logical commit 1](./static/images/logical-commit-rstudio.png){width=75%}

---

Per riassumere, le diverse fasi che intercorrono tra una operazione di commit e la successiva possono essere:

- `stage xyz`: aggiungi xyz dal commit
- `unstage xyz`: rimuovi xyz dal commit
- `discard xyz`: revert (ritorna indietro) rispetto ai cambiamenti su xyz ( `r emo::ji("warning")` stai attento, questo non pu√≤ essere riportato indietro! `r emo::ji("warning")` )

E `xyz` pu√≤ essere

- una `linea` singola
- una `selezione` di linee
- un `chunk` di codice
    - RStudio si occuper√† di spezzare i cambiamenti in pi√π chunks
    - I chunks sono definiti come 10 linee di codice non cambiate tra gli effettivi cambiamenti

---

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Effettua due differenti cambiamenti al `README.md` localmente
1. Crea un `commit` per ogni cambiamento tale che:
    1. Seleziona il cambiamento e mettilo in `stage`
    1. Aggiungi un messaggio di `commit` e clicca su `Commit`
1. non `Push`are (ancora...)
</div>

---

## Crea un Conflitto

Alcune volte accade, soprattuto in ambienti molto collaborativi o con tanti contributori che pi√π collaboratori lavorino sulle stesse linee di codice. Non c'√® da preoccuparsi, adesso impariamo ad amministrare i conflitti e risolverli. Lo faremi creandone uno.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
Aggiorna il `README.md` direttamente online su GitHub, sulla stessa identica linea che hai cambiato nell'esercizio precedente.
</div>

---

Se non ti ricordi o non sai come si fa un cambiamento online, per favore controlla [questo tutorial](https://help.github.com/articles/create-a-repo/#commit-your-first-change). Guarda poi i risultati online del commit. Ricorda che non c'√®  bisogno di spingere i cambiamenti  `Push`ando il commit, siamo gi√† online, non serve, infattic contestualmente `Push`ando cambia immediatamente il contenuto della repo.

![Commit to create conflict](./static/images/commit-to-create-conflict.png){width=75%}

---

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
Torna indietro su Rstudio e prova a spingere (click `push`) i cambiamenti locali.
</div>

---
Git ti aiuta avvertendoti che ci sono dei cambiamenti remoti ( _remote changes_ ) sulla stessa repo.

![Conflict](./static/images/conflict-rstudio1.png){width=75%}

---

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
Clicca su `Pull` per tirare i cambiamenti dentro la tua repo GitHub (fare il download) 
</div>

Git ti notifica un conflitto i.e. **CONFLICT** e ti chiede cosa vuoi fare, le operazioni da fare sono 2:

1. Metti a posto il conflitto
1. Commit del risultato dopo aver messo a posto il conflitto

![Conflict](./static/images/conflict-rstudio2.png){width=75%}

---

Adesso con calma va risolto il conflitto!

Ogni conflitto √® sempre evidenziato con la seguente sintassi:

```
<<<<<<< HEAD
il tuo codice locale
=======
il codice che esiste su GitHub
>>>>>>> origin/master
```x

Per risolvere il conflitto devi decidere quale delle due versioni ti convince di pi√π viceversa e quale vuoi scartare.

---

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Apri il `README.md` in RStudio:

        <<<<<<< HEAD
        A simple analysis to visualize my favourite fruit colour.
        =======
        A simple analysis to discover my favourite fruit color.
        >>>>>>> origin/master

2. Scegli solo la _versione_ preferita (in questo caso quella su GitHub):

        A simple analysis to discover my favourite fruit colour.

3. Committa il risultato
4. Clicca su `Push` per aggiornare GitHub
</div>

Se tu dovessi incontrare nuovi conflitti in futuro utilizza il semplice _modus operandi_ che hai appena visto.

---

## Aggiungi un nuovoi file

Durante lo sviluppo di un progetto nuovi files sono introdotti, pure questi necessitano di un controllo di versione!.
Le nuove cartelle insieme ai files possono essere aggiunte e successivamente committate, esattamente come ogni altro cambiamento.

Spuntando la casella accanto al nuovo file/cartella appena aggiunto viene messo in fase `stage`. Mettere in `stage` una nuova cartella metter√† in automatico ogni file contenuto nella cartella. 
Tuttavia RStudio non ti permetter√† di mettere in `stage` una cartella vuota!

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Aggiungi il file `fruits.csv` all'interno di `/data` (subdirectory)
1. Aggiungi un collegamento a file `README.md` (usando il path relativo), menzionando la funzione del file
1. Adesso Commit tutti e due i cambiamenti (il nuovo file `fruits.csv`  e le modifiche apportate al `README.md`) in un singolo messaggiio di commit
</div>
---

RStudio provvede ad informati circa lo status dei files

- `README.md` file √® stato cambiato (*Modified* <span style="color: blue;">M</span>)
- `data/` √® per il momento sconosciuto a git (*Question mark* <span style="color: yellow;">?</span>)

![Add a file](./static/images/add-file-rstudio1.png){width=75%}

---

Sputando tutti e due li far√† diventare pronti per il commit. Ricorda che `data/fruits.csv` diventa verde visto che viene <span style="color: green;">Aggiunto</span>:

![Add a file](./static/images/add-file-rstudio2.png){width=75%}

---

## Adatta l'ultimo commit

Succede spesso che vengano committate linee di codice ma ci si dimentichi di altre o che quelle stesse necessitino una piccola revisione. Git provvede attraverso l'abilit√† `amend` modificando il precedente commit con gli adattamenti necessari.

<div class="bs-callout bs-callout-exercise">
<h4>Esercizio:</h4>
1. Fai un cambiamento in `fruits.csv`
1. `Commit` come sempre, ma **spunta** la casella `amend previous commit` (accanto al bottone `Commit`)
</div>

**Attenzione:** don't do this on commits that have been pushed. That would result in conflicts.

---

Next to the `Commit` box, the `amend` option is available:

![Add a file](./static/images/amend-commit-rstudio.png){width=75%}

<!-- <div class="question">`  -->

<!-- 1. Prima domanda? -->
<!-- 1. Seconda domanda? -->

<!-- </div>` -->


---

## View history

One of the advantages of using version control with regular commits is that you get a history of your project. You can check the history (the series of commits) both online on GitHub as well as in Rstudio:

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. Within Rstudio, click on `history` in the `git` pane
1. On the webpage of your repository, chek the commit list
</div>

---

Notice the presence of `History` twice in the following image: 

- As a separate pane (your R command history): this has nothing to do with Git
- Within the `git` pane (the history of your commit messages)

![View history](./static/images/history-rstudio1.png){width=75%}

---

You can click on each of the commits to verify the adaptations that were part of the specific commit:

![View history](./static/images/history-rstudio2.png){width=75%}

---

## Create a branch to experiment

### How to make a new branch?

It is good practice to ALWAYS work on (short-living) branches. It allows you to freely experiment until you are satisfied of the result and it ensures your `master` provides the last stable version of your analysis/project.

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. click on `Create branch` symbol* (next to the current branch name)
1. Provide a branch name (lowercase, no spaces)
1. Keep remote on `origin`
1. Check the box `Sync branch with remote`
1. Click `Create`
</div>

*the create branch symbol looks as follows:
![](./static/images/rstudio_branch_symbol.png)

---

Make sure your branch name makes sense for the work you are planning to do. Use lower case characters and `-` in between words (NO spaces!). For this example, we decided to use the name `analysis-script` for the branch name. 

![Create branch](./static/images/branch-rstudio3.png){width=75%}

---

<div class="alert alert-danger">
<h4>Remark!</h4>
Older versions of Rstudio do not provide the functionality to create a branch directly! You will have to use the `Shell` to create the new branch:
</div>

<div class="bs-callout bs-callout-info">
<h4>Shell based approach to create a new branch:</h4>
1. Open the git shell
1. Create a branch by a `checkout` to new `branch`:
    ```
    git checkout -b analysis-script
    ```
1. Get an overview of your branches: `git branch`
1. Type `git push -u origin analysis-script` to activate `Push`/`Pull` buttons

Shell based approach to create a new branch:
![Create branch](./static/images/create-branch-rstudio.png){width=75%}

This will also activate the `pull` and `push` buttons. From now on, you can commit as many times as you want/need to this branch and push the commits to GitHub, where it will be stored under the same branch name:

![First push branch](./static/images/branch-first-push-rstudio.png){width=75%}
</div>

---

We can work on the just created branch and start making adaptations:

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. Add an analysis file in a `/src` directory
1. `Commit` the adaptation to the branch
1. Click `Push` to send the adaptations to Github
1. On GitHub website, look for your branch and check the adaptations to the branch
</div>

---

### Effect of switching branches

The first time you switch branches and you see files disappearing, you might be wondering what is happening. No worries, Git is just making sure you only see those files relevant for the active branch. In the next exercise, we will explore this feature in more detail:

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. Click on the right-top dropdown in the `git` pane
1. Switch to the status of the `master` branch by selecting `(LOCAL BRANCHES) -> master`
1. Verify your local directory structure in file explorer: where are your files?
1. Switch back to the status of the new branch (in the example i.e. `analysis-script`)
1. Verify your local directory structure in file explorer again: where are your files?
</div>

---

As in our example, the branch name is `analysis-script`, the dropdown defines this as the currently active branch. Clicking on the dropdown provides an overview of all branches:

![Switch branch](./static/images/branch-rstudio1.png){width=75%}

---

Rstudio provides you information about the switch to the `master` branch:

![Switch branch](./static/images/branch-rstudio2.png){width=75%}

<div class="alert alert-danger">
Make sure you are currently working on your newly created branch (e.g. `analysis-script`) before you proceed!
</div>

---

## Pull requests

When satisfied about the work done in a branch, it is time to bring these adaptations to the `master` branch as part of the *stable* analysis. NEVER merge locally on your machine, we will ALWAYS merge a branch online, by making use of a `Pull request`!

---

### Create a pull request

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. Click `push` (if not already done)
2. At [Github](https://github.com/), browse to your repository.
3. Create a `pull request` online
</div>

---

Github actually suggests you to `Compare & Pull request` on the webpage in a new yellow box. If you do not see the messag, you can still initiate a `Pull request`. The `Pull request` aims to insert the adaptations in your branch into the `master` branch. 

![Check Github message pull request](./static/images/pull-request-intro.png){width=75%}

---

In a new dialog, you can provide a short summary line about the `Pull request` with the option to add additional information. By clicking the `Create pull request` button, you actually propose the merge into the `master` branch.

![Adapt Github message and start pull request](./static/images/pull-request_message.png){width=75%}

---

### Review your pull request

While working on your own and you are sure about the changes, you can actually merge the `Pull request` yourself. Although, this is the ideal moment for revision of the code (you can ask people to review your code, but automated checks can be added as well).

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. Review your own code!
2. If OK, merge the `Pull request`. 
3. Do not forget to delete the branch online (Github asks you to)
</div>

---

![See pull request](./static/images/pr.png){width=75%}


---

### Include your accepted work to local master

For the moment, your adaptations are integrated into the `master` branch online, but not yet on your local computer. So, you have to update the local `master` branch:

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
1. In Rstudio, switch to the `master` branch (right top in `Git` pane)
1. Click `Pull`
1. Remove the local branch as well (otherwise you will have a lot of them after a while). You need to open the Shell:
    ```
    git branch -d analysis-script
    ```
</div>

![git pull](./static/images/pull-rstudio.png){width=75%}

---

# Working together {data-background=#c2c444}

---

## Invite collaborators

You now have experienced all the major steps to effectively use version control with Git. We can now apply these same steps when working together.

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
* Team up with two or three persons
* Let one person invite the others, provide them with read/write access as explained in [this tutorial](https://help.github.com/articles/inviting-collaborators-to-a-personal-repository/)
</div>

---

On your own repository, you have all admin rights to add `Collaborators` in the `Settings` section of GitHub:

![Invite collaborator](./static/images/invite-collaborator.png){width=75%}

---

When invited to collaborate, you have to `Accept invitation` in order to start working on the repository:

![react to collaborator](./static/images/react-collaborator.png){width=75%}

---

## Issues

Issues can be used for multiple purposes: alerting colleagues about a bug in the code, proposing new features, discussing specific steps in the analysis,...

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
* Raise an `issue` online
* Provide issues with an appropriate `label`
* Assign your colleague to the issue
</div>

---

## Online adaptations

When there is no coding involved, e.g. you just need to update a few text lines in a markdown file, the usage of the online GitHub features could be sufficient enough: 

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
* Make an adaptation to an online file
* Propose a `pull request` and assign your collaborator
* Merge the adaptation to the `master` branch
</div>

---

## Local adaptations

In this section, all the individual steps come together to collaborate on the code of your project. First, we will start with a rehearsel of the individual steps as an exercise. Afterwards, we will try out a workflow that can be used as a step by step procedure in the future.

<div class="alert alert-danger">
<h4>Remember!</h4>
**Working on a local branch - merging online**
</div>

---

You can interpret the following exercise as a wrap-up of the steps learnt in the previous section:

<div class="bs-callout bs-callout-exercise">
<h4>Exercise:</h4>
* As collaborator, `clone` the other repository to your local computer
* Create a new `branch` locally with a different name
* Adapt the content of a file
* `Commit` your adaptation
* `Push` your `branch` to the remote repository
* Go to GitHub and make a `Pull request`
* Revise the work and `merge` online when appropriate
* Update your local work
* Check if all adaptations are represented in your local files
</div>

**Tip**: All functionalities are described in the previous sections

---

## Step by step workflow

The steps of the previous exercise provide the main building blocks. Nevertheless, when working on a project, a step by step procedure can help in the beginning to remember the workflow. A dedicated version for Rstudio is available at this repo as a separate [workflow overview](./workflow_rstudio.html).

---

## Release

Once you are satisfied with the status of your analysis, it makes sense to create a release:

* For publications (DOI)
* For code/software development versions
* For course notes

Follow [this tutorial](https://help.github.com/articles/creating-releases/) to create a release.

---

# Some more *Rules for collaboration*:

* Commit often, make small commits
* Don't mix changes in 1 commit
* Think about your commit messages
* Always commit into a feature branch, never in the `master` branch.
* Always start features branches from the `master` branch.
* Only work in your own branches.
* Never merge someone else's `pull request` without their consent.
* Don't keep long-lived branches (form of technical debt)

---

**There's no such thing, as a free lunch...**

---

<!-- ...but if you're hungry you can  -->

<!-- * Webinars -->
<!--     - [Github and Rstudio management](https://www.rstudio.com/resources/webinars/rstudio-essentials-webinar-series-managing-part-2/) -->
<!--     - [Collaboration and time travel: version control with git, github and RStudio](https://www.rstudio.com/resources/webinars/collaboration-and-time-travel-version-control-with-git-github-and-rstudio/) -->

<!-- * Tutorials -->
<!--     - [Hadley Wickham R packages book](http://r-pkgs.had.co.nz/git.html) -->
<!--     - [Happy Git and GitHub for the useR](http://happygitwithr.com/index.html) -->

<!-- --- -->

<!-- Information combined at [INBO Git course](https://github.com/inbo/git-course). <br/>You're welcome to provide issues, pull requests,... -->



